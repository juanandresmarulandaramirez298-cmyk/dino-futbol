<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego Dino</title>
  <style>
    * { margin: 0; padding: 0; }
    body {
      height: 100vh;
      background: #584040;
      display: flex;
      align-items: center;
    }
    .contenedor {
      width: 920px;
      height: 320px;
      margin: 0 auto;
      position: relative;
      background: url(img/estadio.png) repeat-x;
      background-size: 1000px 320px;
      border-radius: 10px;
      overflow: hidden;
    }
    .dino {
      width: 84px;
      height: 77px;
      position: absolute;
      bottom: 10px;
      left: 42px;
      z-index: 2;
      background: url(img/balonbueno.png);
      background-size: 84px 84px;
    }
    .dino-corriendo {
      animation: animarDino 0.25s steps(2) infinite;
    }
    .dino-estrellado {
      background-position-x: -252px;
    }
    .suelo {
      width: 200%;
      height: 42px;
      position: absolute;
      bottom: 0;
      left: 0;
      background: url(img/pngwing.com.png) repeat-x;
      background-size: 50% 50px;
    }
    .score {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #032203;
      font-family: verdana;
      font-size: 30px;
      font-weight: bold;
      z-index: 10;
    }
    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      color: black;
      display: none;
      z-index: 20;
      text-align: center;
    }
    .boton-balon {
      width: 80px;
      height: 80px;
      background: url('img/balonbueno.png') no-repeat center center;
      background-size: cover;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      margin-top: 20px;
      animation: rebote 1s infinite;
      transition: transform 0.2s ease;
    }
    .boton-balon:hover {
      transform: scale(1.1);
    }
    @keyframes rebote {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .obstaculo {
      width: 100px;
      height: 154px;
      position: absolute;
      bottom: 10px;
      background: url(img/cristiano.png) no-repeat;
      background-size: 100px 154px;
    }
    @keyframes animarDino {
      from { background-position-x: -84px; }
      to { background-position-x: -252px; }
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <div class="suelo"></div>
    <div class="dino dino-corriendo"></div>
    <div class="score">0</div>
    <div class="game-over">
      Â¡Perdiste!
      <br>
      <button class="boton-balon" onclick="location.reload()"></button>
    </div>
  </div>

  <script>
    let time = new Date();
    let deltatime = 0;

    if (document.readyState === "complete" || document.readyState === "interactive") {
      setTimeout(Init, 1);
    } else {
      document.addEventListener("DOMContentLoaded", Init);
    }

    function Init() {
      time = new Date();
      start();
      Loop();
    }

    function Loop() {
      deltatime = (new Date() - time) / 1000;
      time = new Date();
      Update();
      requestAnimationFrame(Loop);
    }

    const sueloY = 22;
    let velY = 0;
    const impulso = 900;
    const gravedad = 2500;

    let dinoPostY = sueloY;
    let sueloX = 0;
    const VelEscenario = 1280 / 3;
    let gameVel = 1;
    let score = 0;
    let saltando = false;
    let parado = false;

    let contenedor, dino, textoScore, suelo, gameOver;
    let obstaculos = [];

    function start() {
      suelo = document.querySelector(".suelo");
      contenedor = document.querySelector(".contenedor");
      textoScore = document.querySelector(".score");
      dino = document.querySelector(".dino");
      gameOver = document.querySelector(".game-over");
      document.addEventListener("keydown", HandleKeyDown);
      document.addEventListener("touchstart", HandleTouchStart);
      setInterval(() => {
        if (!parado) crearObstaculo();
      }, 2000);
    }

    function HandleKeyDown(ev) {
      if (ev.keyCode === 32) saltar();
    }

    function HandleTouchStart(ev){
      saltar();
    }

    function saltar() {
      if (dinoPostY === sueloY) {
        saltando = true;
        velY = impulso;
        dino.classList.remove("dino-corriendo");
      }
    }

    function Update() {
      if (parado) return;
      moverSuelo();
      moverDino();
      moverObstaculos();
      detectarColision();
      velY -= gravedad * deltatime;
    }

    function moverSuelo() {
      sueloX += calcularDesplazamiento();
      suelo.style.left = -(sueloX % contenedor.clientWidth) + "px";
    }

    function calcularDesplazamiento() {
      return VelEscenario * deltatime * gameVel;
    }

    function moverDino() {
      dinoPostY += velY * deltatime;
      if (dinoPostY < sueloY) tocarSuelo();
      dino.style.bottom = dinoPostY + "px";
    }

    function tocarSuelo() {
      dinoPostY = sueloY;
      velY = 0;
      if (saltando) dino.classList.add("dino-corriendo");
      saltando = false;
    }

    function crearObstaculo() {
      const obstaculo = document.createElement("div");
      obstaculo.classList.add("obstaculo");
      contenedor.appendChild(obstaculo);
      obstaculo.style.left = "920px";
      obstaculo.puntajeSumado = false;
      obstaculos.push(obstaculo);
    }

    function moverObstaculos() {
      for (let i = 0; i < obstaculos.length; i++) {
        let obs = obstaculos[i];
        let left = parseFloat(obs.style.left);
        obs.style.left = (left - calcularDesplazamiento()) + "px";

        if (left + 50 < 42 && !obs.puntajeSumado) {
          score++;
          textoScore.innerText = score;
          obs.puntajeSumado = true;

          // Aumentar velocidad cada 5 puntos
          if (score % 5 === 0) {
            gameVel += 0.5;
          }
        }

        if (left < -50) {
          obs.remove();
          obstaculos.splice(i, 1);
          i--;
        }
      }
    }

    function detectarColision() {
      for (let obs of obstaculos) {
        let obsLeft = parseFloat(obs.style.left);
        let obsRight = obsLeft + 50;
        let dinoLeft = 42;
        let dinoRight = dinoLeft + 84;

        if (obsRight > dinoLeft && obsLeft < dinoRight) {
          if (dinoPostY < 60) {
            gameOver.style.display = "block";
            dino.classList.remove("dino-corriendo");
            dino.classList.add("dino-estrellado");
            parado = true;
          }
        }
      }
    }
  </script>
</body>
</html>
